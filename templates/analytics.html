{% extends "base.html" %}

{% block title %}Analytics{% endblock %}

{% block styles %}
<style>
.chart-container {
    background: white;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    padding: 1rem;
    margin-bottom: 1.5rem;
}

.stats-card {
    background: white;
    border-radius: 8px;
    padding: 1rem;
    margin-bottom: 1rem;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.stats-card h3 {
    margin-top: 0;
    color: #333;
    font-size: 1.2rem;
}

.stats-value {
    font-size: 2rem;
    font-weight: bold;
    color: #007bff;
}

.recent-test {
    padding: 0.5rem;
    border-bottom: 1px solid #eee;
}

.recent-test:last-child {
    border-bottom: none;
}
</style>
{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2>Analytics Dashboard</h2>
    
    <!-- Loading State -->
    <div id="loadingState" class="text-center py-5">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>
    
    <!-- Error State -->
    <div id="errorState" class="alert alert-danger d-none" role="alert">
        Failed to load analytics data. Please try again later.
    </div>
    
    <!-- Content -->
    <div id="analyticsContent" class="d-none">
        <!-- Overview Stats -->
        <div class="row mb-4">
            <div class="col-12 mb-4">
                <div class="stats-card">
                    <h3>Missed Problems by Category</h3>
                    <div id="missedProblemsBreakdown"></div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card">
                    <h3>Total Tests</h3>
                    <div class="stats-value" id="totalTests">-</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card">
                    <h3>Average Time</h3>
                    <div class="stats-value" id="averageTime">-</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card">
                    <h3>Total Questions</h3>
                    <div class="stats-value" id="totalQuestions">-</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card">
                    <h3>Completion Rate</h3>
                    <div class="stats-value" id="completionRate">-</div>
                </div>
            </div>
        </div>
        
        <!-- Charts Row 1 -->
        <div class="row mb-4">
            <div class="col-md-8">
                <div class="chart-container">
                    <h3>Performance Over Time</h3>
                    <canvas id="performanceChart"></canvas>
                </div>
            </div>
            <div class="col-md-4">
                <div class="chart-container">
                    <h3>Time Distribution</h3>
                    <canvas id="timeDistributionChart"></canvas>
                </div>
            </div>
        </div>
        
        <!-- Charts Row 2 -->
        <div class="row mb-4">
            <div class="col-md-6">
                <div class="chart-container">
                    <h3>Category Performance</h3>
                    <canvas id="categoryChart"></canvas>
                </div>
            </div>
            <div class="col-md-6">
                <div class="chart-container">
                    <h3>Recent Tests</h3>
                    <div id="recentTests"></div>
                </div>
            </div>
        </div>
        
        <!-- Category Breakdown -->
        <div class="row">
            <div class="col-12">
                <div class="chart-container">
                    <h3>Detailed Category Breakdown</h3>
                    <div id="categoryBreakdown"></div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="{{ url_for('static', filename='analytics.js') }}"></script>
{% endblock %}
